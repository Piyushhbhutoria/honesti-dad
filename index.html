<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HonestBox - Anonymous Feedback Platform</title>
    <meta name="description"
      content="Get honest, anonymous feedback from friends and colleagues. Share your thoughts without revealing your identity through our secure platform." />
    <meta name="author" content="HonestBox" />

    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#14B8A6" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="HonestBox" />
    <!--
      IMPORTANT (Preview stability):
      In Lovable preview, asset requests like /manifest.json may be redirected through an auth bridge,
      which can be blocked by CORS for the browser's manifest fetch.
      This doesn't matter for local development but can cause the preview to appear "stuck".
      So we only attach the manifest in production builds.
    -->
    <script type="module">
      if (import.meta.env?.PROD) {
        const link = document.createElement('link');
        link.rel = 'manifest';
        link.href = '/manifest.json';
        document.head.appendChild(link);
      }
    </script>

    <!-- Favicon -->
    <link rel="icon" href="/favicon.ico" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico" />

    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="/icon-192x192.png" />
    <link rel="apple-touch-icon" sizes="152x152" href="/icon-192x192.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/icon-192x192.png" />
    <link rel="apple-touch-icon" sizes="167x167" href="/icon-192x192.png" />

    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="HonestBox - Anonymous Feedback Platform" />
    <meta property="og:description"
      content="Get honest, anonymous feedback from friends and colleagues. Share your thoughts without revealing your identity through our secure platform." />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="/icon-512x512.png" />
    <meta property="og:image:width" content="512" />
    <meta property="og:image:height" content="512" />
    <meta property="og:site_name" content="HonestBox" />

    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="HonestBox - Anonymous Feedback Platform" />
    <meta name="twitter:description"
      content="Get honest, anonymous feedback from friends and colleagues. Share your thoughts without revealing your identity." />
    <meta name="twitter:image" content="/icon-512x512.png" />

    <!-- Additional PWA Meta Tags -->
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="application-name" content="HonestBox" />
    <meta name="msapplication-TileColor" content="#14B8A6" />
    <meta name="msapplication-config" content="/browserconfig.xml" />

    <!-- Google Analytics -->
    <!-- Note: Replace GA_MEASUREMENT_ID with your actual Google Analytics measurement ID -->
    <!-- Set VITE_GA_MEASUREMENT_ID in your .env file for automatic replacement -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-9JJDYZ5G68"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() { dataLayer.push(arguments); }

      // Only initialize GA if measurement ID is properly set
      const measurementId = 'G-9JJDYZ5G68';
      if (measurementId && !measurementId.includes('VITE_')) {
        gtag('js', new Date());
        gtag('config', measurementId, {
          page_title: document.title,
          page_location: window.location.href,
          cookie_flags: 'secure;samesite=strict',
          // anonymize_ip: true,
          // allow_google_signals: false,
          // allow_ad_personalization_signals: false
        });
      }
    </script>
  </head>

  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>

    <!-- Service Worker Registration (only in production); unregister in preview/dev to avoid stale caches -->
    <script type="module">
      if ('serviceWorker' in navigator) {
        const isProd = import.meta.env && import.meta.env.PROD;

        if (isProd) {
          window.addEventListener('load', () => {
            navigator.serviceWorker.register('/sw.js')
              .then((registration) => {
                console.log('SW registered: ', registration);
              })
              .catch((registrationError) => {
                console.log('SW registration failed: ', registrationError);
              });
          });
        } else {
          // In preview/dev: actively unregister any existing SW and clear caches to prevent blank screen
          navigator.serviceWorker.getRegistrations().then((regs) => {
            regs.forEach((reg) => reg.unregister());
          });
          if (window.caches) {
            caches.keys().then((keys) => {
              keys.forEach((key) => {
                if (key.startsWith('honestbox-')) caches.delete(key);
              });
            });
          }
        }
      }
    </script>
  </body>

</html>
